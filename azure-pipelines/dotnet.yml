parameters:
- name: RunTests
- name: Is1ESPT
  type: boolean
- name: BuildRequiresAccessToken
  type: boolean
  default: false

steps:

- script: dotnet build -t:build,pack --no-restore -c $(BuildConfiguration) -warnAsError -warnNotAsError:NU1901,NU1902,NU1903,NU1904,LOCTASK002 /bl:"$(Build.ArtifactStagingDirectory)/build_logs/build.binlog"
  displayName: ðŸ›  dotnet build
  ${{ if parameters.BuildRequiresAccessToken }}:
    env:
      SYSTEM_ACCESSTOKEN: $(System.AccessToken)

- powershell: tools/dotnet-test-cloud.ps1 -Configuration $(BuildConfiguration) -Agent $(Agent.JobName) -PublishResults
  displayName: ðŸ§ª dotnet test
  condition: and(succeeded(), ${{ parameters.RunTests }})
