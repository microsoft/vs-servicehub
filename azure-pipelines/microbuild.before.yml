parameters:
- name: ShouldSkipOptimize
- name: IsProfilingRun
  type: boolean
  default: false

steps:
- task: ComponentGovernanceComponentDetection@0
  displayName: ğŸ” Component Detection

- task: notice@0
  displayName: ğŸ› ï¸ Generate NOTICE file
  inputs:
    outputfile: $(System.DefaultWorkingDirectory)/obj/NOTICE
    outputformat: text
  condition: and(succeeded(), ne(variables['Build.Reason'], 'PullRequest'))
  retryCountOnTaskFailure: 3 # fails when the cloud service is overloaded

# We have to install the signing plugin ourselves for Optprof runs because those pipelines haven't migrated to 1ES PT yet.
- ${{ if parameters.IsProfilingRun }}:
  - task: MicroBuildSigningPlugin@4
    inputs:
      signType: Real
      zipSources: false
    displayName: ğŸ”§ Install MicroBuild Signing Plugin
